{% extends 'base.html' %}
{% load static %}

{% block title %}CSV Ä°ÅŸlemleri - Iris SÄ±nÄ±flandÄ±rma Sistemi{% endblock %}

{% block content %}
<!-- CSV Export BÃ¶lÃ¼mÃ¼ -->
<div class="forms-container">
    <h2>ğŸ“¥ CSV DÄ±ÅŸa Aktar</h2>
    
    <div class="info-box">
        <p>KayÄ±tlarÄ±nÄ±zÄ± CSV formatÄ±nda indirerek yedeÄŸi alabilir veya baÅŸka programlarda kullanabilirsiniz.</p>
        <ul style="margin-top: 10px; padding-left: 20px;">
            <li>âœ“ TÃ¼m Iris kayÄ±tlarÄ±nÄ±z</li>
            <li>âœ“ Excel ile uyumlu</li>
            <li>âœ“ AnÄ±nda indirme</li>
        </ul>
    </div>

    <form action="/api/csv/export/" method="get">
        <button type="submit" class="btn">
            ğŸ“Š CSV DosyasÄ± Ä°ndir
        </button>
    </form>
</div>

<!-- CSV Import BÃ¶lÃ¼mÃ¼ -->
<div class="forms-container">
    <h2>ğŸ“¤ CSV Ä°Ã§e Aktar</h2>
    
    <div class="info-box">
        <p>CSV dosyasÄ±ndan toplu Iris verileri yÃ¼kleyebilirsiniz.</p>
    </div>

    <div class="info-box" style="background-color: rgba(23, 162, 184, 0.1); border-color: #17a2b8;">
        <h3 style="color: #17a2b8; margin-top: 0;">ğŸ“‹ CSV Dosya FormatÄ±:</h3>
        <div style="background-color: #0f1a35; border-radius: 6px; padding: 15px; margin: 15px 0; overflow-x: auto; border: 1px solid #2d4a7c;">
            <code style="color: #4a9eff; font-family: monospace; font-size: 0.9em; display: block; white-space: pre;">Sepal Length,Sepal Width,Petal Length,Petal Width,Species,Location ID
5.1,3.5,1.4,0.2,Iris-setosa,1
6.2,2.9,4.3,1.3,Iris-versicolor,2
7.3,2.9,6.3,1.8,Iris-virginica,3</code>
        </div>
        <p style="color: #ffc107; font-weight: bold;">âš ï¸ Ä°lk satÄ±r baÅŸlÄ±k satÄ±rÄ±dÄ±r ve otomatik atlanÄ±r.</p>
    </div>

    <form action="/api/csv/import/" method="post" enctype="multipart/form-data" id="import-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="csv_file">CSV DosyasÄ± SeÃ§in:</label>
            <div style="position: relative;">
                <input type="file" name="csv_file" id="csv_file" accept=".csv" required 
                       style="position: absolute; left: -9999px;">
                <label for="csv_file" style="display: block; padding: 15px 20px; background-color: #2d4a7c; border: 2px dashed #4a9eff; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease;">
                    <span id="file-name" style="color: #b8d4ff; font-weight: 500;">ğŸ“ Dosya SeÃ§ (.csv)</span>
                </label>
            </div>
        </div>
        
        <button type="submit" class="btn">
            ğŸ“¤ DosyayÄ± YÃ¼kle
        </button>
    </form>
</div>

<!-- Bilgilendirme -->
<div class="forms-container">
    <h2>ğŸ’¡ Bilgilendirme</h2>
    
    <div class="info-box">
        <ul style="padding-left: 20px; color: #b8d4ff;">
            <li>CSV dosyasÄ± virgÃ¼lle ayrÄ±lmÄ±ÅŸ deÄŸerler iÃ§ermelidir</li>
            <li>Location ID opsiyoneldir (boÅŸ bÄ±rakÄ±labilir)</li>
            <li>Dosya UTF-8 kodlamalÄ± olmalÄ±dÄ±r</li>
            <li>Maksimum dosya boyutu: 5MB</li>
            <li>Ä°Ã§e aktarÄ±lan veriler mevcut kayÄ±tlara eklenir</li>
        </ul>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('csv_file').addEventListener('change', function(e) {
    var fileName = e.target.files[0] ? e.target.files[0].name : 'ğŸ“ Dosya SeÃ§ (.csv)';
    document.getElementById('file-name').textContent = fileName;
});

document.getElementById('import-form').addEventListener('submit', function(e) {
    var fileInput = document.getElementById('csv_file');
    if (!fileInput.files.length) {
        e.preventDefault();
        alert('LÃ¼tfen bir CSV dosyasÄ± seÃ§in!');
        return false;
    }
    
    var file = fileInput.files[0];
    if (!file.name.endsWith('.csv')) {
        e.preventDefault();
        alert('LÃ¼tfen sadece .csv uzantÄ±lÄ± dosya yÃ¼kleyin!');
        return false;
    }
    
    // 5MB limit
    if (file.size > 5 * 1024 * 1024) {
        e.preventDefault();
        alert('Dosya boyutu 5MB\'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r!');
        return false;
    }
    
    return true;
});
</script>
{% endblock %}
